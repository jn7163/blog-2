/*! inline-attach - v1.2.5 - 2013-07-31 */
(function(e,n){"use strict";function t(){for(var e={},n=arguments.length-1;n>=0;n--){var t=arguments[n];for(var a in t)e[a]=t[a]}return e}n.inlineAttach=function(e,a){function i(e,n){return(e+"\n\n[[D]]"+n).replace(/(\n{2,})\[\[D\]\]/,"\n\n").replace(/^(\n*)/,"")}var o,r=t(e,inlineAttach.defaults),l=a,u="{filename}",d=this;this.uploadFile=function(e){var n=new FormData,t=new XMLHttpRequest,a="png";if(e.name){var i=e.name.match(/\.(.+)$/);i&&(a=i[1])}n.append(r.uploadFieldName,e,"image-"+Date.now()+"."+a),t.open("POST",r.uploadUrl),t.onload=function(){if(200===t.status||201===t.status){var e=JSON.parse(t.responseText);d.onUploadedFile(e)}else d.onErrorUploading()},t.send(n)},this.isAllowedFile=function(e){return r.allowedTypes.indexOf(e.type)>=0},this.onUploadedFile=function(e){var n=r.onUploadedFile(e),t=e[r.downloadFieldName];if(n!==!1&&t){var a=l.getValue().replace(o,r.urlText.replace(u,t));l.setValue(a)}},this.customUploadHandler=function(e){return r.customUploadHandler(e)},this.onErrorUploading=function(){var e=l.getValue().replace(o,"");l.setValue(e),r.customErrorHandler()&&n.alert(r.errorText)},this.onReceivedFile=function(e){var n=r.onReceivedFile(e);n!==!1&&(o=r.progressText,l.setValue(i(l.getValue(),o)))},this.onPaste=function(e){var n=!1,t=e.clipboardData;if("object"==typeof t&&null!==t.items)for(var a=0;t.items.length>a;a++){var i=t.items[a];d.isAllowedFile(i)&&(n=!0,this.onReceivedFile(i.getAsFile()),this.customUploadHandler(i.getAsFile())&&this.uploadFile(i.getAsFile()))}return n},this.onDrop=function(e){for(var n=!1,t=0;e.dataTransfer.files.length>t;t++){var a=e.dataTransfer.files[t];d.isAllowedFile(a)&&(n=!0,this.onReceivedFile(a),this.customUploadHandler(a)&&this.uploadFile(a))}return n}},n.inlineAttach.Editor=function(e){var n=e;return{getValue:function(){return n.value},setValue:function(e){n.value=e}}},n.inlineAttach.defaults={uploadUrl:"upload_attachment.php",uploadFieldName:"file",downloadFieldName:"filename",allowedTypes:["image/jpeg","image/png","image/jpg","image/gif"],progressText:"![Uploading file...]()",urlText:"![file]({filename})",onReceivedFile:function(){},customUploadHandler:function(){return!0},customErrorHandler:function(){return!0},errorText:"Error uploading file",onUploadedFile:function(){}},n.inlineAttach.attachToInput=function(e,n){n=n||{};var t=new inlineAttach.Editor(e),a=new inlineAttach(n,t);e.addEventListener("paste",function(e){a.onPaste(e)},!1),e.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),a.onDrop(e)},!1),e.addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()},!1)}})(document,window),function(e,n){"use strict";function t(e){if(!e.getWrapperElement)throw"Invalid CodeMirror object given";var n=e;return{getValue:function(){return n.getValue()},setValue:function(e){var t=n.getCursor();n.setValue(e),n.setCursor(t)}}}t.prototype=new inlineAttach.Editor,n.inlineAttach.attachToCodeMirror=function(e,n){n=n||{};var a=new t(e),i=new inlineAttach(n,a),o=e.getWrapperElement();o.addEventListener("paste",function(e){i.onPaste(e)},!1),e.setOption("onDragEvent",function(e,n){return"drop"===n.type?(n.stopPropagation(),n.preventDefault(),i.onDrop(n)):void 0})}}(document,window);